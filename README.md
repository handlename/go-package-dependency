# go-package-depends

A command-line tool that generates Go dependency files based on architectural layer definitions in Markdown format.

## Overview

`go-package-depends` helps enforce clean architecture principles by automatically generating `dependency.gen.go` files that contain import declarations based on dependency relationships defined in a `DEPENDENCY.md` file. This ensures that your Go modules follow the intended architectural layers and dependency directions.

## Features

- 📝 **Markdown-driven**: Define your architecture layers and dependencies in a simple `DEPENDENCY.md` file
- 🔄 **Automatic generation**: Creates `dependency.gen.go` files with appropriate import statements
- 🏗️ **Clean architecture**: Enforces dependency direction and prevents circular dependencies
- 🚀 **Build-time validation**: Dependency violations are caught during compilation
- 📦 **Module-aware**: Automatically detects Go module names from `go.mod`

## Usage

```bash
go run github.com/handlename/go-package-depends@latest <path-to-dependency-md>
```

or

```bash
go get -tool github.com/handlename/go-package-depends@latest
go tool go-package-depends <path-to-dependency-md>
```

### Examples

```bash
# Generate dependency files from DEPENDENCY.md
go-package-depends example/DEPENDENCY.md

# Show help
go-package-depends --help
```

## DEPENDENCY.md Format

The `DEPENDENCY.md` file should follow this structure:

```markdown
# Dependencies

## Dependencies
- Infra layer -> Presentation layer -> Application layer -> Domain layer

## Layers
- Domain layer
  - domain/entity
- Application layer
  - usecase
- Presentation layer
  - router
- Infra layer
  - infra/database
```

### Format Specification

#### Dependencies Section
- Define dependency chains using arrows (`->`)
- Dependencies flow from left to right
- Each layer can depend on the layers to its right

#### Layers Section
- Define layer names and their corresponding package paths
- Use bullet points (`-`) for layer names
- Use indented bullet points (`  -`) for package paths
- Package paths are relative to the directory containing `DEPENDENCY.md`

## Generated Files

For each layer with a defined package path, `go-package-depends` generates a `dependency.gen.go` file containing:

```go
// Code generated by go-package-depends. DO NOT EDIT.

package usecase

import (
	_ "github.com/handlename/go-package-depends/example/domain/entity"
)
```

### Example Project Structure

```
example/
├── DEPENDENCY.md
├── go.mod
├── domain/
│   └── entity/
│       └── dependency.gen.go
├── usecase/
│   └── dependency.gen.go
├── router/
│   └── dependency.gen.go
└── infra/
    └── database/
        └── dependency.gen.go
```

## Benefits

### 1. Enforced Architecture
- **Compile-time validation**: Dependency violations cause build failures
- **Clear boundaries**: Explicit layer definitions prevent architectural drift
- **Documentation**: `DEPENDENCY.md` serves as living architecture documentation

### 2. Clean Code
- **Dependency direction**: Ensures dependencies flow in the intended direction
- **Circular dependency prevention**: Go compiler catches circular imports
- **Maintainability**: Clear architectural boundaries improve code organization

### 3. Team Collaboration
- **Shared understanding**: Team members can easily understand the architecture
- **Code reviews**: Architectural violations are visible in pull requests
- **Onboarding**: New team members quickly grasp the project structure

## Use Cases

- **Clean Architecture**: Implement Uncle Bob's Clean Architecture pattern
- **Hexagonal Architecture**: Enforce port-adapter pattern boundaries
- **Layered Architecture**: Maintain traditional N-tier architecture
- **Domain-Driven Design**: Separate domain, application, and infrastructure concerns

## Configuration

### Module Detection

`go-package-depends` automatically detects your Go module name from the `go.mod` file in the same directory as your `DEPENDENCY.md` file.

### Directory Structure

- Place `DEPENDENCY.md` in the root of your module or submodule
- Package paths in the layers section are relative to the `DEPENDENCY.md` location
- Each layer's directory must exist for the dependency file to be generated

## Advanced Examples

### Complex Dependency Chain

```markdown
## Dependencies
- Infrastructure -> Interface -> Application -> Domain
- Shared -> Domain
- Shared -> Application
- Shared -> Interface
```

### Multiple Packages Per Layer

```markdown
## Layers
- Domain layer
  - domain/entity
  - domain/repository
  - domain/service
- Application layer
  - usecase/user
  - usecase/order
```

## License

This project is licensed under the MIT License. See the [LICENSE](LICENSE) file for details.

## Author

@handlename (Hiroaki NAGATA) w/ AI agent
