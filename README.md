# go-depends

A command-line tool that generates Go dependency files based on architectural layer definitions in Markdown format.

## Overview

`go-depends` helps enforce clean architecture principles by automatically generating `dependency.gen.go` files that contain import declarations based on dependency relationships defined in a `DEPENDENCY.md` file. This ensures that your Go modules follow the intended architectural layers and dependency directions.

## Features

- üìù **Markdown-driven**: Define your architecture layers and dependencies in a simple `DEPENDENCY.md` file
- üîÑ **Automatic generation**: Creates `dependency.gen.go` files with appropriate import statements
- üèóÔ∏è **Clean architecture**: Enforces dependency direction and prevents circular dependencies
- üöÄ **Build-time validation**: Dependency violations are caught during compilation
- üì¶ **Module-aware**: Automatically detects Go module names from `go.mod`

## Installation

### From source

```bash
git clone https://github.com/handlename/go-depends.git
cd go-depends
go build -o go-depends main.go
```

### Using go install

```bash
go install github.com/handlename/go-depends@latest
```

## Usage

```bash
go-depends <path-to-dependency-md>
```

### Examples

```bash
# Generate dependency files from DEPENDENCY.md
go-depends example/DEPENDENCY.md

# Show help
go-depends --help
```

## DEPENDENCY.md Format

The `DEPENDENCY.md` file should follow this structure:

```markdown
# Dependencies

## Dependencies
- Infra layer -> Presentation layer -> Application layer -> Domain layer

## Layers
- Domain layer
  - domain/entity
- Application layer
  - usecase
- Presentation layer
  - router
- Infra layer
  - infra/database
```

### Format Specification

#### Dependencies Section
- Define dependency chains using arrows (`->`)
- Dependencies flow from left to right
- Each layer can depend on the layers to its right

#### Layers Section
- Define layer names and their corresponding package paths
- Use bullet points (`-`) for layer names
- Use indented bullet points (`  -`) for package paths
- Package paths are relative to the directory containing `DEPENDENCY.md`

## Generated Files

For each layer with a defined package path, `go-depends` generates a `dependency.gen.go` file containing:

```go
// Code generated by go-depends. DO NOT EDIT.

package usecase

import (
	_ "github.com/handlename/go-depends/example/domain/entity"
)
```

### Example Project Structure

```
example/
‚îú‚îÄ‚îÄ DEPENDENCY.md
‚îú‚îÄ‚îÄ go.mod
‚îú‚îÄ‚îÄ domain/
‚îÇ   ‚îî‚îÄ‚îÄ entity/
‚îÇ       ‚îî‚îÄ‚îÄ dependency.gen.go
‚îú‚îÄ‚îÄ usecase/
‚îÇ   ‚îî‚îÄ‚îÄ dependency.gen.go
‚îú‚îÄ‚îÄ router/
‚îÇ   ‚îî‚îÄ‚îÄ dependency.gen.go
‚îî‚îÄ‚îÄ infra/
    ‚îî‚îÄ‚îÄ database/
        ‚îî‚îÄ‚îÄ dependency.gen.go
```

## Benefits

### 1. Enforced Architecture
- **Compile-time validation**: Dependency violations cause build failures
- **Clear boundaries**: Explicit layer definitions prevent architectural drift
- **Documentation**: `DEPENDENCY.md` serves as living architecture documentation

### 2. Clean Code
- **Dependency direction**: Ensures dependencies flow in the intended direction
- **Circular dependency prevention**: Go compiler catches circular imports
- **Maintainability**: Clear architectural boundaries improve code organization

### 3. Team Collaboration
- **Shared understanding**: Team members can easily understand the architecture
- **Code reviews**: Architectural violations are visible in pull requests
- **Onboarding**: New team members quickly grasp the project structure

## Use Cases

- **Clean Architecture**: Implement Uncle Bob's Clean Architecture pattern
- **Hexagonal Architecture**: Enforce port-adapter pattern boundaries
- **Layered Architecture**: Maintain traditional N-tier architecture
- **Domain-Driven Design**: Separate domain, application, and infrastructure concerns

## Configuration

### Module Detection

`go-depends` automatically detects your Go module name from the `go.mod` file in the same directory as your `DEPENDENCY.md` file.

### Directory Structure

- Place `DEPENDENCY.md` in the root of your module or submodule
- Package paths in the layers section are relative to the `DEPENDENCY.md` location
- Each layer's directory must exist for the dependency file to be generated

## Advanced Examples

### Complex Dependency Chain

```markdown
## Dependencies
- Infrastructure -> Interface -> Application -> Domain
- Shared -> Domain
- Shared -> Application
- Shared -> Interface
```

### Multiple Packages Per Layer

```markdown
## Layers
- Domain layer
  - domain/entity
  - domain/repository
  - domain/service
- Application layer
  - usecase/user
  - usecase/order
```

## Troubleshooting

### Common Issues

1. **Directory not found**: Ensure all package paths in `DEPENDENCY.md` exist
2. **Module not found**: Check that `go.mod` exists in the same directory as `DEPENDENCY.md`
3. **Parsing errors**: Verify the `DEPENDENCY.md` format follows the specification



## Contributing

1. Fork the repository
2. Create your feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add some amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

### Development Setup

```bash
git clone https://github.com/handlename/go-depends.git
cd go-depends
go mod tidy
go test ./...
```

## License

This project is licensed under the MIT License. See the [LICENSE](LICENSE) file for details.

## Acknowledgments

- Inspired by Clean Architecture principles by Robert C. Martin
- Built with Go's powerful dependency management and build system
- Thanks to the Go community for architectural patterns and best practices

## Related Projects

- [golang-standards/project-layout](https://github.com/golang-standards/project-layout) - Standard Go project layout
- [ardanlabs/service](https://github.com/ardanlabs/service) - Service architecture example
- [bxcodec/go-clean-arch](https://github.com/bxcodec/go-clean-arch) - Clean architecture implementation
